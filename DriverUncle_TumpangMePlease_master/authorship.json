[
  {
    "path": "report.md",
    "fileType": "md",
    "lines": [
      {
        "lineNumber": 1,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "\u003cdiv style\u003d\"height: 29.7cm; width: 21cm; text-align: center;\"\u003e"
      },
      {
        "lineNumber": 2,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003ch1\u003e"
      },
      {
        "lineNumber": 3,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        CS2102 - GROUP 26"
      },
      {
        "lineNumber": 4,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003c/h1\u003e"
      },
      {
        "lineNumber": 5,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003cbr\u003e"
      },
      {
        "lineNumber": 6,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003cdiv style\u003d\"font-size:2rem; padding-bottom:1rem;\"\u003e"
      },
      {
        "lineNumber": 7,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        TumpangMePlease "
      },
      {
        "lineNumber": 8,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 9,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 10,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 11,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 12,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        A CarPooling App"
      },
      {
        "lineNumber": 13,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 14,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 15,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cimg src\u003d\"https://i.imgur.com/iCxmJXZ.jpg\"\u003e"
      },
      {
        "lineNumber": 16,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003c/img\u003e"
      },
      {
        "lineNumber": 17,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003c/div\u003e"
      },
      {
        "lineNumber": 18,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003ch3 style\u003d\"text-align: right\"\u003e"
      },
      {
        "lineNumber": 19,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cdiv style\u003d\"font-weight:bold; font-size:2rem;\"\u003eTeam:\u003c/div\u003e"
      },
      {
        "lineNumber": 20,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 21,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        James Pang Mun Wai - A0169761R"
      },
      {
        "lineNumber": 22,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 23,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 24,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        Jin Shuyuan - A0162475B"
      },
      {
        "lineNumber": 25,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 26,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 27,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        Lee Jin Yao - A0168574N"
      },
      {
        "lineNumber": 28,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 29,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        \u003cbr\u003e"
      },
      {
        "lineNumber": 30,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        Teo Xuan Wei - A0168645R"
      },
      {
        "lineNumber": 31,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003c/h3\u003e"
      },
      {
        "lineNumber": 32,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "\u003c/div\u003e"
      },
      {
        "lineNumber": 33,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 34,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "# Introduction"
      },
      {
        "lineNumber": 35,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Project Description"
      },
      {
        "lineNumber": 36,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "This is a carpooling application which allows car drivers to advertise opportunities for carpooling and passengers to search for car rides. "
      },
      {
        "lineNumber": 37,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 38,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Drivers can create an advertisement that specifies the locations to pick and drop  a passenger. Other users can then bid for the desired advertisements. Passengers can then bid for the rides. The successful bidder for an advertisement can be chosen by the car driver or automatically allocated by the system based on some criteria. "
      },
      {
        "lineNumber": 39,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 40,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Each user can be both a passenger and a driver, and users will need to create an account in order to use the app."
      },
      {
        "lineNumber": 41,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 42,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Project Responsibilities"
      },
      {
        "lineNumber": 43,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Member | Contributions |"
      },
      {
        "lineNumber": 44,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| -------- | -------- |"
      },
      {
        "lineNumber": 45,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| James Pang Mun Wai | \u003cul\u003e\u003cli\u003eSetup and designed the entire front-end of the web application\u003c/li\u003e\u003cli\u003eImplemented both front-end and back-end functionalities for payment page, promo code, profile page, home page, bidding and reviewing\u003c/li\u003e\u003cli\u003eConstant checking of web application to ensure that it is bug free\u003c/li\u003e\u003cli\u003eAdded dummy SQL data\u003c/li\u003e\u003cli\u003eSchedule weekly meetings, set agendas, delegate tasks to teammates and ensure team\u0027s progress\u003c/li\u003e\u003cli\u003eComplex query and functionality for system auto selection of winning bid\u003c/li\u003e\u003cli\u003eComplex query and functionality for best promo code suggestion\u003c/li\u003e\u003cli\u003eVerifying whether decomposed tables are in BCNF\u003c/li\u003e\u003c/ul\u003e|"
      },
      {
        "lineNumber": 46,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Jin Shuyuan | \u003cul\u003e\u003cli\u003eAdd triggers, procedures and functions into SQL file\u003c/li\u003e\u003cli\u003eImplement back-end functionality of car registration page\u003c/li\u003e\u003cli\u003eImplement back-end functionality of create advertisement page\u003c/li\u003e\u003cli\u003eLink front-end display with back-end functionality of car registration page\u003c/li\u003e\u003cli\u003eLink front-end display with back-end functionality of create advertisement page\u003c/li\u003e\u003cli\u003eModify front-end display of home page\u003c/li\u003e\u003cli\u003eVerifying whether decomposed tables are in BCNF\u003c/li\u003e\u003c/ul\u003e |"
      },
      {
        "lineNumber": 47,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Lee Jin Yao | \u003cul\u003e\u003cli\u003eTranslate ER diagram to SQL tables and populated sample data\u003c/li\u003e\u003cli\u003eImplemented search functionalities to filter advertisements based on destination locations\u003c/li\u003e\u003cli\u003eImplemented bid functionality for passengers\u003c/li\u003e\u003cli\u003eImplemented upcoming driver pick-ups\u003c/li\u003e\u003cli\u003eImplemented driver updating ride status\u003c/li\u003e\u003cli\u003eConducted system test on app to weed out bugs and fixed them\u003c/li\u003e\u003c/ul\u003e |"
      },
      {
        "lineNumber": 48,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Teo Xuan Wei |\u003cul\u003e\u003cli\u003eTranslate ER diagram to SQL tables\u003c/li\u003e\u003cli\u003eLink view advertisement page to backend database\u003c/li\u003e\u003cli\u003eLink view advertisement page to backend database\u003c/li\u003e\u003cli\u003eModify front-end display of view advertisement page to ensure buttons perform relevant queries\u003c/li\u003e\u003cli\u003eInclude checks to ensure only active advertisements and bids are shown on the front-end\u003c/li\u003e\u003cli\u003eModify presentable ER diagram using Lucid-chart\u003c/li\u003e\u003c/ul\u003e|"
      },
      {
        "lineNumber": 49,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Entire Team | \u003cul\u003e\u003cli\u003eDesigned the ER Diagram\u003c/li\u003e\u003cli\u003eMade decisions on the constraints\u003c/li\u003e\u003cli\u003eReport and Documentation\u003c/li\u003e\u003c/ul\u003e|"
      },
      {
        "lineNumber": 50,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Software Tools and Frameworks"
      },
      {
        "lineNumber": 51,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Front-end"
      },
      {
        "lineNumber": 52,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- Bootstrap "
      },
      {
        "lineNumber": 53,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- JQuery"
      },
      {
        "lineNumber": 54,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- HTML, CSS, JavaScript"
      },
      {
        "lineNumber": 55,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Back-end"
      },
      {
        "lineNumber": 56,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- Python Flask"
      },
      {
        "lineNumber": 57,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- PostgreSQL Database"
      },
      {
        "lineNumber": 58,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 59,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "# Database Design"
      },
      {
        "lineNumber": 60,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Application Requirements and Constraints"
      },
      {
        "lineNumber": 61,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Relationships \u0026 Participation Constraints"
      },
      {
        "lineNumber": 62,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 63,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "* Advertisement constraints:"
      },
      {
        "lineNumber": 64,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each advertisement can be created by exactly one  ( \u003d 1) driver"
      },
      {
        "lineNumber": 65,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each advertisement can go from exactly one ( \u003d 1) Place"
      },
      {
        "lineNumber": 66,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each advertisement can go to exactly one ( \u003d 1) Place"
      },
      {
        "lineNumber": 67,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 68,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "* Bid constraints:"
      },
      {
        "lineNumber": 69,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each bid can schedule for at most one ( \u003c\u003d 1) ride"
      },
      {
        "lineNumber": 70,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "* Ride constraints:"
      },
      {
        "lineNumber": 71,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each ride can be scheduled by exactly one ( \u003d 1) bid"
      },
      {
        "lineNumber": 72,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "* Promo code constraints:"
      },
      {
        "lineNumber": 73,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each passenger can redeem at most one ( \u003c\u003d 1) promo for each ride"
      },
      {
        "lineNumber": 74,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "* Driver and car constraints:"
      },
      {
        "lineNumber": 75,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each driver owns at least one ( \u003e\u003d 1) car"
      },
      {
        "lineNumber": 76,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each car is owned by at least one ( \u003e\u003d 1) driver"
      },
      {
        "lineNumber": 77,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 78,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "* AppUser (satisfies both overlapping and covering constraints):"
      },
      {
        "lineNumber": 79,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each user can be both driver and passenger."
      },
      {
        "lineNumber": 80,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  * Each user must be either driver, passenger, or both."
      },
      {
        "lineNumber": 81,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 82,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Requirements"
      },
      {
        "lineNumber": 83,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1) When creating an advertisement, the earliest departure time must be at least an hour after the date of posting the advertisement."
      },
      {
        "lineNumber": 84,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2) A user can create/amend bids up to 30 minutes before the scheduled departure time."
      },
      {
        "lineNumber": 85,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "3) When it is exactly 30 minutes before the departure time, the system should execute `system auto selection` to select the winning bid based on a certain criteria. We currently simulate this functionality as a button to press instead of a timer that constantly checks for any advertisement that is expiring."
      },
      {
        "lineNumber": 86,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "4) A user cannot be a driver unless he/she has registered for at least one car."
      },
      {
        "lineNumber": 87,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "5) A passenger cannot bid with a price lower than the minimum price stated for the advertisement."
      },
      {
        "lineNumber": 88,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "6) A driver cannot bid for his/her own advertisement."
      },
      {
        "lineNumber": 89,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "7) A promo cannot be redeemed if its max quota is reached."
      },
      {
        "lineNumber": 90,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "8) Every new bid by a passenger for the same advertisement must be greater than or equal to his/her old bid."
      },
      {
        "lineNumber": 91,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "9) When an advertisement is deleted, all the bids for that advertisement will be default to `failed` bid."
      },
      {
        "lineNumber": 92,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "10) When a winning bid is chosen for an advertisement, all other bids for that advertisement will be default to `failed` bid."
      },
      {
        "lineNumber": 93,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "11) To ensure that the passenger pays for his successful ride, he/she will always be redirected to the payment page and will not be able to access any other functionalities until he/she makes the necessary payment."
      },
      {
        "lineNumber": 94,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 95,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Entity-Relationship Diagram"
      },
      {
        "lineNumber": 96,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "![](https://i.imgur.com/UVnjmct.png)"
      },
      {
        "lineNumber": 97,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 98,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Justification for usage of serial id in Ride table"
      },
      {
        "lineNumber": 99,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "The initial plan was to have Ride as a weak entity set to the Bids aggregation. However, having it as a weak entity set meant that it would be a many-to-one relationship: multiple rides to one bid. This was not what we aim to model as only the successful bid amongst the rest (at most one), will be scheduled as a ride. Hence for simplicity\u0027s sake, we decided to use a serial id `ride_id` as the primary key for identifying every successfully scheduled ride."
      },
      {
        "lineNumber": 100,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 101,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Relational Schema"
      },
      {
        "lineNumber": 102,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 103,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Entity Tables"
      },
      {
        "lineNumber": 104,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 105,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE App_User ("
      },
      {
        "lineNumber": 106,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    username     varchar(50) PRIMARY KEY,"
      },
      {
        "lineNumber": 107,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    first_name   varchar(20) NOT NULL,"
      },
      {
        "lineNumber": 108,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    last_name    varchar(20) NOT NULL,"
      },
      {
        "lineNumber": 109,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    password     varchar(50) NOT NULL,"
      },
      {
        "lineNumber": 110,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    phone_number varchar(20) NOT NULL"
      },
      {
        "lineNumber": 111,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 112,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 113,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Driver ("
      },
      {
        "lineNumber": 114,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    username varchar(50) PRIMARY KEY REFERENCES App_User ON DELETE CASCADE,"
      },
      {
        "lineNumber": 115,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    d_rating NUMERIC"
      },
      {
        "lineNumber": 116,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 117,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 118,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Passenger ("
      },
      {
        "lineNumber": 119,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    username varchar(50) PRIMARY KEY REFERENCES App_User ON DELETE CASCADE,"
      },
      {
        "lineNumber": 120,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    p_rating NUMERIC"
      },
      {
        "lineNumber": 121,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 122,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 123,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Car ("
      },
      {
        "lineNumber": 124,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    plate_number    varchar(20) PRIMARY KEY,"
      },
      {
        "lineNumber": 125,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    colour          varchar(20) NOT NULL,"
      },
      {
        "lineNumber": 126,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    brand           varchar(20) NOT NULL,"
      },
      {
        "lineNumber": 127,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    no_passengers   INTEGER NOT NULL,"
      },
      {
        "lineNumber": 128,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    CHECK(no_passengers \u003e\u003d 1)"
      },
      {
        "lineNumber": 129,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 130,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 131,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Promo ("
      },
      {
        "lineNumber": 132,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    promo_code   varchar(20) PRIMARY KEY,"
      },
      {
        "lineNumber": 133,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    max_quota    INTEGER NOT NULL,"
      },
      {
        "lineNumber": 134,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    min_price    INTEGER,"
      },
      {
        "lineNumber": 135,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    discount     INTEGER NOT NULL"
      },
      {
        "lineNumber": 136,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 137,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 138,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Place ("
      },
      {
        "lineNumber": 139,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    name varchar(50) PRIMARY KEY"
      },
      {
        "lineNumber": 140,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 141,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 142,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Advertisement ("
      },
      {
        "lineNumber": 143,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    time_posted       TIMESTAMP   DEFAULT date_trunc(\u0027second\u0027, "
      },
      {
        "lineNumber": 144,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                                                     current_timestamp),"
      },
      {
        "lineNumber": 145,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    driver_ID         varchar(50) REFERENCES Driver ON DELETE CASCADE,"
      },
      {
        "lineNumber": 146,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    num_passengers    INTEGER     NOT NULL,"
      },
      {
        "lineNumber": 147,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    departure_time    TIMESTAMP   NOT NULL,"
      },
      {
        "lineNumber": 148,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    price             INTEGER     NOT NULL, -- minimum bidding price"
      },
      {
        "lineNumber": 149,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    to_place          varchar(50) NOT NULL REFERENCES Place,"
      },
      {
        "lineNumber": 150,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    from_place        varchar(50) NOT NULL REFERENCES Place,"
      },
      {
        "lineNumber": 151,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    ad_status         varchar(20) NOT NULL,"
      },
      {
        "lineNumber": 152,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    PRIMARY KEY (time_posted, driver_ID),"
      },
      {
        "lineNumber": 153,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    CHECK       (num_passengers \u003e 0),"
      },
      {
        "lineNumber": 154,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    CHECK       (ad_status \u003d \u0027Active\u0027 OR ad_status \u003d \u0027Scheduled\u0027 OR "
      },
      {
        "lineNumber": 155,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                 ad_status \u003d \u0027Deleted\u0027)"
      },
      {
        "lineNumber": 156,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 157,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 158,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Ride ("
      },
      {
        "lineNumber": 159,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    ride_ID        SERIAL      PRIMARY KEY,"
      },
      {
        "lineNumber": 160,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    passenger_ID   varchar(50) NOT NULL,"
      },
      {
        "lineNumber": 161,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    driver_ID      varchar(50) NOT NULL,"
      },
      {
        "lineNumber": 162,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    time_posted    TIMESTAMP   NOT NULL,"
      },
      {
        "lineNumber": 163,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    status         varchar(20) DEFAULT \u0027pending\u0027,"
      },
      {
        "lineNumber": 164,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    is_paid        BOOLEAN NOT NULL DEFAULT false,"
      },
      {
        "lineNumber": 165,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    p_comment      varchar(50),"
      },
      {
        "lineNumber": 166,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    p_rating       numeric,"
      },
      {
        "lineNumber": 167,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    d_comment      varchar(50),"
      },
      {
        "lineNumber": 168,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    d_rating       numeric,"
      },
      {
        "lineNumber": 169,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    FOREIGN KEY (passenger_ID, time_posted, driver_ID) REFERENCES Bids,"
      },
      {
        "lineNumber": 170,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    CHECK (status \u003d \u0027pending\u0027 OR status \u003d \u0027ongoing\u0027 OR status \u003d \u0027completed\u0027)"
      },
      {
        "lineNumber": 171,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 172,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 173,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 174,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Relationship Tables"
      },
      {
        "lineNumber": 175,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 176,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Bids ("
      },
      {
        "lineNumber": 177,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    passenger_ID     varchar(50) REFERENCES Passenger ON DELETE CASCADE,"
      },
      {
        "lineNumber": 178,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    driver_ID        varchar(50) REFERENCES Driver    ON DELETE CASCADE,"
      },
      {
        "lineNumber": 179,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    time_posted      TIMESTAMP\t DEFAULT date_trunc(\u0027second\u0027, "
      },
      {
        "lineNumber": 180,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                                                   current_timestamp),"
      },
      {
        "lineNumber": 181,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    price            NUMERIC,"
      },
      {
        "lineNumber": 182,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    status           varchar(20),"
      },
      {
        "lineNumber": 183,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    no_passengers    INTEGER,"
      },
      {
        "lineNumber": 184,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    PRIMARY KEY (passenger_ID, time_posted, driver_ID),"
      },
      {
        "lineNumber": 185,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    CHECK       (passenger_ID \u003c\u003e driver_ID),"
      },
      {
        "lineNumber": 186,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    CHECK       (status \u003d \u0027ongoing\u0027 OR status \u003d \u0027successful\u0027 OR "
      },
      {
        "lineNumber": 187,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                 status \u003d \u0027failed\u0027),"
      },
      {
        "lineNumber": 188,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    CHECK       (price \u003e 0)"
      },
      {
        "lineNumber": 189,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 190,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 191,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Redeems ("
      },
      {
        "lineNumber": 192,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    ride_ID       INTEGER     PRIMARY KEY  REFERENCES Ride,"
      },
      {
        "lineNumber": 193,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    promo_code    varchar(20) NOT NULL     REFERENCES Promo,"
      },
      {
        "lineNumber": 194,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    username      varchar(50) NOT NULL     REFERENCES Passenger"
      },
      {
        "lineNumber": 195,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 196,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 197,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TABLE Owns ("
      },
      {
        "lineNumber": 198,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    driver_ID    varchar(50) REFERENCES Driver,"
      },
      {
        "lineNumber": 199,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    plate_number varchar(20) REFERENCES Car,"
      },
      {
        "lineNumber": 200,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    PRIMARY KEY (driver_ID, plate_number)"
      },
      {
        "lineNumber": 201,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ");"
      },
      {
        "lineNumber": 202,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 203,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 204,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Normal Forms"
      },
      {
        "lineNumber": 205,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 206,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "All the tables are in BCNF."
      },
      {
        "lineNumber": 207,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 208,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "The following table lists all the attribute mappings in the ER diagram:"
      },
      {
        "lineNumber": 209,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Attributes    | Simplified Attributes| "
      },
      {
        "lineNumber": 210,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| ------------- |:-------------:| "
      },
      {
        "lineNumber": 211,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| username     | A| "
      },
      {
        "lineNumber": 212,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| first_name     | B     |   "
      },
      {
        "lineNumber": 213,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| last_name | C     |   "
      },
      {
        "lineNumber": 214,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|password|D|"
      },
      {
        "lineNumber": 215,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|phone_number|E|"
      },
      {
        "lineNumber": 216,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|p_rating (Passenger)|F|"
      },
      {
        "lineNumber": 217,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|price|G|"
      },
      {
        "lineNumber": 218,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|no_passengers (Bids)|H|"
      },
      {
        "lineNumber": 219,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|status|I|"
      },
      {
        "lineNumber": 220,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|no_passengers (Advertisement)|J|"
      },
      {
        "lineNumber": 221,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|ad_status|K|"
      },
      {
        "lineNumber": 222,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|time_posted|L|"
      },
      {
        "lineNumber": 223,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|departure_time|M|"
      },
      {
        "lineNumber": 224,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|price|N|"
      },
      {
        "lineNumber": 225,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|d_rating (Driver)|O|"
      },
      {
        "lineNumber": 226,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|colour|P|"
      },
      {
        "lineNumber": 227,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|no_passengers (Car)|Q|"
      },
      {
        "lineNumber": 228,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|brand|R|"
      },
      {
        "lineNumber": 229,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|plate_number|S|"
      },
      {
        "lineNumber": 230,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|name|T|"
      },
      {
        "lineNumber": 231,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|ride_ID|U|"
      },
      {
        "lineNumber": 232,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|is_paid|V|"
      },
      {
        "lineNumber": 233,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|status|W|"
      },
      {
        "lineNumber": 234,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|d_rating (Ride)|X|"
      },
      {
        "lineNumber": 235,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|d_comment|Y|"
      },
      {
        "lineNumber": 236,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|p_comment|Z|"
      },
      {
        "lineNumber": 237,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|p_rating (Ride)|À|"
      },
      {
        "lineNumber": 238,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|min_price|È|"
      },
      {
        "lineNumber": 239,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|discount|Ì|"
      },
      {
        "lineNumber": 240,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|max_quota|Ò|"
      },
      {
        "lineNumber": 241,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "|promo_code|Ù|"
      },
      {
        "lineNumber": 242,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 243,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 244,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 245,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Non-trivial Functional Dependencies from ER Diagram:"
      },
      {
        "lineNumber": 246,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "AppUser: A -\u003e BCDE"
      },
      {
        "lineNumber": 247,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Passenger: A -\u003e F"
      },
      {
        "lineNumber": 248,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Driver: A -\u003e O"
      },
      {
        "lineNumber": 249,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Car: S -\u003e RPQ"
      },
      {
        "lineNumber": 250,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Promo: Ù -\u003e ÈÌÒ"
      },
      {
        "lineNumber": 251,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Ride: U -\u003e VWXYZÀ"
      },
      {
        "lineNumber": 252,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Advertisement: AL -\u003e JKMN"
      },
      {
        "lineNumber": 253,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Bids: AL -\u003e GHI"
      },
      {
        "lineNumber": 254,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 255,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "FDs \u003d { A -\u003e BCDE; A -\u003e F; A -\u003e O; S -\u003e RPQ; Ù -\u003e ÈÌÒ; U -\u003e VWXYZÀ; AL -\u003e JKMN; AL -\u003e GHI }"
      },
      {
        "lineNumber": 256,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 257,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Table   | Projection| "
      },
      {
        "lineNumber": 258,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| ------------- |:-------------:| "
      },
      {
        "lineNumber": 259,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| AppUser: R1(\u003cu\u003eA\u003c/u\u003e,B,C,D,E)| { A -\u003e BCDE }| "
      },
      {
        "lineNumber": 260,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Passenger: R2(\u003cu\u003eA\u003c/u\u003e,F)| { A -\u003e F }| "
      },
      {
        "lineNumber": 261,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Driver: R3(\u003cu\u003eA\u003c/u\u003e,O)| { A -\u003e O }| "
      },
      {
        "lineNumber": 262,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Car: R4(\u003cu\u003eS\u003c/u\u003e,R,P,Q)| { S -\u003e RPQ }| "
      },
      {
        "lineNumber": 263,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Promo: R5(\u003cu\u003eÙ\u003c/u\u003e,È,Ì,Ò)| { Ù -\u003e ÈÌÒ }| "
      },
      {
        "lineNumber": 264,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Ride: R6(\u003cu\u003eU\u003c/u\u003e,V,W,X,Y,Z,À)| { U -\u003e VWXYZÀ }| "
      },
      {
        "lineNumber": 265,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Advertisement: R7(\u003cu\u003eA,L\u003c/u\u003e,M,N,K,J)| { AL -\u003e JKMN }| "
      },
      {
        "lineNumber": 266,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "| Bids: R8(\u003cu\u003eA,L\u003c/u\u003e,G,H,I)| { AL -\u003e GHI }| "
      },
      {
        "lineNumber": 267,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 268,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "None of the non-trivial FDs in projected FDs violate BCNF."
      },
      {
        "lineNumber": 269,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Thus, all the decomposed tables are in BCNF."
      },
      {
        "lineNumber": 270,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 271,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 272,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 273,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 274,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Non-trivial Constraints Enforced By Triggers"
      },
      {
        "lineNumber": 275,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Ensuring bid price to be higher than previous bids"
      },
      {
        "lineNumber": 276,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "We placed a constraint on the bids where further bids on the same advertisement must have a higher price."
      },
      {
        "lineNumber": 277,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 278,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE OR REPLACE FUNCTION update_bid_failed()"
      },
      {
        "lineNumber": 279,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "RETURNS TRIGGER AS $$ BEGIN"
      },
      {
        "lineNumber": 280,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "RAISE NOTICE \u0027New bid price should be higher\u0027; RETURN NULL;"
      },
      {
        "lineNumber": 281,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "END; $$ LANGUAGE plpgsql;"
      },
      {
        "lineNumber": 282,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 283,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TRIGGER bid_update_trig"
      },
      {
        "lineNumber": 284,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "BEFORE UPDATE ON bids FOR EACH ROW"
      },
      {
        "lineNumber": 285,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHEN (NEW.price \u003c OLD.price)"
      },
      {
        "lineNumber": 286,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "EXECUTE PROCEDURE update_bid_failed();"
      },
      {
        "lineNumber": 287,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 288,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Updating the average rating of passengers and drivers"
      },
      {
        "lineNumber": 289,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "The current implementation of getting the average rating for each passenger is the average rating across all rides that he/she participated. The rating is given after the ride has been created, hence the passenger rating is added to that ride by using the `UPDATE` operation. Hence, we enforced the automatic calculation of the passenger\u0027s average rating with the following trigger:"
      },
      {
        "lineNumber": 290,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 291,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 292,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE OR REPLACE FUNCTION"
      },
      {
        "lineNumber": 293,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "update_passenger_average_rating() RETURNS TRIGGER AS"
      },
      {
        "lineNumber": 294,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "$tag$"
      },
      {
        "lineNumber": 295,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "DECLARE average_rating numeric;"
      },
      {
        "lineNumber": 296,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "BEGIN"
      },
      {
        "lineNumber": 297,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "RAISE NOTICE \u0027Updating Average Passenger Rating\u0027;"
      },
      {
        "lineNumber": 298,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "SELECT ROUND(SUM(p_rating) / COUNT(*), 2) INTO average_rating FROM Ride "
      },
      {
        "lineNumber": 299,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE passenger_id \u003d OLD.passenger_id AND p_rating IS NOT NULL;"
      },
      {
        "lineNumber": 300,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 301,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "UPDATE Passenger SET p_rating \u003d average_rating "
      },
      {
        "lineNumber": 302,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE username \u003d NEW.passenger_id;"
      },
      {
        "lineNumber": 303,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "RETURN NEW;"
      },
      {
        "lineNumber": 304,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "END;"
      },
      {
        "lineNumber": 305,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "$tag$"
      },
      {
        "lineNumber": 306,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "LANGUAGE plpgsql;"
      },
      {
        "lineNumber": 307,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 308,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TRIGGER update_passenger_ride_rating"
      },
      {
        "lineNumber": 309,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "AFTER UPDATE ON ride FOR EACH ROW"
      },
      {
        "lineNumber": 310,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHEN ((OLD.p_rating \u003c\u003e NEW.p_rating OR OLD.p_rating IS NULL) AND "
      },
      {
        "lineNumber": 311,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       NEW.p_rating IS NOT NULL)"
      },
      {
        "lineNumber": 312,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "EXECUTE PROCEDURE update_passenger_average_rating();"
      },
      {
        "lineNumber": 313,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 314,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 315,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "A similar trigger is also created to compute the average rating of drivers."
      },
      {
        "lineNumber": 316,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 317,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "#### Justification of using triggers instead of computing the average rating when needed"
      },
      {
        "lineNumber": 318,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "We noticed that there\u0027s another simpler solution by just querying and computing the average rating for a specific passenger whenever needed. However, the reason behind implementing this as a trigger as opposed the simpler solution is because the average rating is constantly needed in functionalities such as `system auto selection of winning bid`, `viewing of passenger profile` and `driver\u0027s list of bids for his advertisements`. Hence, the simpler solution will be more computationally expensive as it requires to go through the Rides table each time the average rating of passengers is required."
      },
      {
        "lineNumber": 319,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 320,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Chained triggers"
      },
      {
        "lineNumber": 321,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Chained trigger 1: Set the status of Advertisement to `Scheduled` upon successful bid"
      },
      {
        "lineNumber": 322,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "When a bid has been succesfully selected by the system or the driver, the status of relevant advertisement will be changed to `scheduled`. This operation has to be enforced via a trigger and the implementation is as follows:"
      },
      {
        "lineNumber": 323,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 324,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE OR REPLACE FUNCTION update_ad_bid_on_successful_bid()"
      },
      {
        "lineNumber": 325,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "RETURNS TRIGGER AS $$ BEGIN"
      },
      {
        "lineNumber": 326,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    RAISE NOTICE "
      },
      {
        "lineNumber": 327,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u0027Updating advertisement for % % to Scheduled after a successful bid\u0027"
      },
      {
        "lineNumber": 328,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    , NEW.driver_ID, NEW.time_posted;"
      },
      {
        "lineNumber": 329,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    UPDATE Advertisement a SET ad_status \u003d \u0027Scheduled\u0027"
      },
      {
        "lineNumber": 330,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        WHERE (a.time_posted, a.driver_ID) \u003d (NEW.time_posted, NEW.driver_ID);"
      },
      {
        "lineNumber": 331,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    RETURN NULL;"
      },
      {
        "lineNumber": 332,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "END; $$ LANGUAGE plpgsql;"
      },
      {
        "lineNumber": 333,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 334,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TRIGGER update_advertisement_on_successful_bid"
      },
      {
        "lineNumber": 335,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "AFTER UPDATE ON Bids FOR EACH ROW"
      },
      {
        "lineNumber": 336,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHEN (OLD.status \u003d \u0027ongoing\u0027 AND NEW.status \u003d \u0027successful\u0027)"
      },
      {
        "lineNumber": 337,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "EXECUTE PROCEDURE update_ad_bid_on_successful_bid();"
      },
      {
        "lineNumber": 338,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 339,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Chained trigger 2: Set all bids to `failed` status when status of Advertisement changes"
      },
      {
        "lineNumber": 340,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "When a specific advertisement is deleted or scheduled upon selecting a successful bid, all bids targeted to that advertisement should be set to a status of `failed`, apart from the successful bid. We enforce this by using the following trigger:"
      },
      {
        "lineNumber": 341,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 342,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE OR REPLACE FUNCTION update_bid_status_to_fail()"
      },
      {
        "lineNumber": 343,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "RETURNS TRIGGER AS $$ BEGIN"
      },
      {
        "lineNumber": 344,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    RAISE NOTICE "
      },
      {
        "lineNumber": 345,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u0027Updating all non-winning bids for % % to failed\u0027,"
      },
      {
        "lineNumber": 346,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    NEW.driver_ID, NEW.time_posted;"
      },
      {
        "lineNumber": 347,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    UPDATE Bids AS b SET status \u003d \u0027failed\u0027 "
      },
      {
        "lineNumber": 348,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    WHERE (b.time_posted, b.driver_ID) "
      },
      {
        "lineNumber": 349,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    \u003d (NEW.time_posted, NEW.driver_ID) AND b.status \u003d \u0027ongoing\u0027;"
      },
      {
        "lineNumber": 350,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    RETURN NULL;"
      },
      {
        "lineNumber": 351,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "END; $$ LANGUAGE plpgsql;"
      },
      {
        "lineNumber": 352,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 353,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CREATE TRIGGER update_ad_status"
      },
      {
        "lineNumber": 354,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "AFTER UPDATE ON Advertisement FOR EACH ROW"
      },
      {
        "lineNumber": 355,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHEN (NEW.ad_status \u003d \u0027Deleted\u0027 OR NEW.ad_status \u003d \u0027Scheduled\u0027)"
      },
      {
        "lineNumber": 356,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "EXECUTE PROCEDURE update_bid_status_to_fail();"
      },
      {
        "lineNumber": 357,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 358,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 359,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 360,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Complex Queries"
      },
      {
        "lineNumber": 361,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### System\u0027s auto selection of winning bid"
      },
      {
        "lineNumber": 362,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Instead of drivers manually accepting the winning bid based on his/her preference, the winning bid will be automatically chosen by the `system auto selection` functionality that is based on the following order by decreasing priority:"
      },
      {
        "lineNumber": 363,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1.  highest bid price"
      },
      {
        "lineNumber": 364,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2.  highest passenger rating"
      },
      {
        "lineNumber": 365,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "3.  highest number of completed rides"
      },
      {
        "lineNumber": 366,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "4.  if there is still a tie, the winning bid is chosen based on their ascending order of username, alphabetically"
      },
      {
        "lineNumber": 367,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 368,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 369,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "-- SELECT passenger with best bid"
      },
      {
        "lineNumber": 370,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WITH MaxRides AS"
      },
      {
        "lineNumber": 371,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "(SELECT COUNT(*) as count "
      },
      {
        "lineNumber": 372,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "FROM Bids B1 JOIN Ride R1 "
      },
      {
        "lineNumber": 373,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    ON B1.passenger_id \u003d R1.passenger_id"
      },
      {
        "lineNumber": 374,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE B1.driver_id \u003d {{ driver_id }} AND "
      },
      {
        "lineNumber": 375,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "      B1.time_posted \u003d {{ time_posted }} AND "
      },
      {
        "lineNumber": 376,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "      R1.status \u003d \u0027completed\u0027 "
      },
      {
        "lineNumber": 377,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "GROUP BY R1.passenger_id"
      },
      {
        "lineNumber": 378,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "),"
      },
      {
        "lineNumber": 379,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "BidStatistics AS"
      },
      {
        "lineNumber": 380,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "(SELECT B.passenger_id, CASE"
      },
      {
        "lineNumber": 381,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "\tWHEN (price \u003d (SELECT MAX(price) FROM Bids "
      },
      {
        "lineNumber": 382,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                   WHERE driver_id \u003d {{ driver_id }} AND "
      },
      {
        "lineNumber": 383,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                         time_posted \u003d {{ time_posted }}))"
      },
      {
        "lineNumber": 384,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "THEN 1\t"
      },
      {
        "lineNumber": 385,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "ELSE 0 "
      },
      {
        "lineNumber": 386,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "END AS max_price, -- highest price"
      },
      {
        "lineNumber": 387,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 388,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CASE"
      },
      {
        "lineNumber": 389,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHEN ((SELECT p_rating FROM Passenger WHERE username \u003d  B.passenger_id) "
      },
      {
        "lineNumber": 390,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       \u003d "
      },
      {
        "lineNumber": 391,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "      (SELECT max(p_rating) FROM Bids NATURAL JOIN Passenger "
      },
      {
        "lineNumber": 392,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       WHERE driver_id \u003d {{ driver_id }} AND "
      },
      {
        "lineNumber": 393,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "             time_posted \u003d {{ time_posted }}))"
      },
      {
        "lineNumber": 394,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "THEN 1\t"
      },
      {
        "lineNumber": 395,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "ELSE 0\t"
      },
      {
        "lineNumber": 396,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "END AS max_passenger_rating, -- highest rating"
      },
      {
        "lineNumber": 397,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 398,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "CASE"
      },
      {
        "lineNumber": 399,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHEN ((SELECT COUNT(*) FROM Ride R "
      },
      {
        "lineNumber": 400,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       WHERE R.passenger_id \u003d B.passenger_id AND status \u003d \u0027completed\u0027) "
      },
      {
        "lineNumber": 401,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       \u003d "
      },
      {
        "lineNumber": 402,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "      (SELECT MAX(count) FROM MaxRides))"
      },
      {
        "lineNumber": 403,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "THEN 1  "
      },
      {
        "lineNumber": 404,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "ELSE 0  "
      },
      {
        "lineNumber": 405,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "END AS max_passenger_rides -- highest number of rides"
      },
      {
        "lineNumber": 406,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 407,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "FROM Bids B "
      },
      {
        "lineNumber": 408,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE driver_id \u003d {{ driver_id }} AND time_posted \u003d {{ time_posted }}"
      },
      {
        "lineNumber": 409,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ")"
      },
      {
        "lineNumber": 410,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "SELECT BS1.passenger_id FROM BidStatistics BS1"
      },
      {
        "lineNumber": 411,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE NOT EXISTS ("
      },
      {
        "lineNumber": 412,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    SELECT 1 FROM BidStatistics BS2"
      },
      {
        "lineNumber": 413,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "    WHERE (BS2.max_price \u003e BS1.max_price) "
      },
      {
        "lineNumber": 414,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       OR (BS2.max_price \u003d BS1.max_price AND "
      },
      {
        "lineNumber": 415,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "           BS2.max_passenger_rating \u003e BS1.max_passenger_rating) "
      },
      {
        "lineNumber": 416,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       OR (BS2.max_price \u003d BS1.max_price AND "
      },
      {
        "lineNumber": 417,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "           BS2.max_passenger_rating \u003d BS1.max_passenger_rating AND "
      },
      {
        "lineNumber": 418,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "           BS2.max_passenger_rides \u003e BS1.max_passenger_rides)"
      },
      {
        "lineNumber": 419,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ")"
      },
      {
        "lineNumber": 420,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "ORDER BY BS1.passenger_id ASC;"
      },
      {
        "lineNumber": 421,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 422,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Note: If there are no bids for the particular advertisement, the advertisement will have a status of `failed`."
      },
      {
        "lineNumber": 423,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 424,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Getting the list of advertisements available"
      },
      {
        "lineNumber": 425,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Only list of active advertisements that are at least 30 mins before their departure time will be retrieved with their details such as time remaining to bid and maximum bidding price. The user\u0027s own listed advertisements will not be shown."
      },
      {
        "lineNumber": 426,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 427,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "SELECT a.time_posted::timestamp(0) AS date_posted, "
      },
      {
        "lineNumber": 428,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       a.departure_time::timestamp(0) AS departure_time,"
      },
      {
        "lineNumber": 429,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       a.driver_id, "
      },
      {
        "lineNumber": 430,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       (SELECT d_rating FROM Driver WHERE username \u003d a.driver_id), "
      },
      {
        "lineNumber": 431,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       a.from_place, a.to_place, a.num_passengers, a.price,"
      },
      {
        "lineNumber": 432,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       (SELECT max(price) FROM bids b "
      },
      {
        "lineNumber": 433,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        WHERE b.time_posted \u003d a.time_posted AND "
      },
      {
        "lineNumber": 434,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "              b.driver_id \u003d a.driver_id) AS highest_bid,"
      },
      {
        "lineNumber": 435,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       (SELECT COUNT(*) FROM bids b "
      },
      {
        "lineNumber": 436,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        WHERE b.time_posted \u003d a.time_posted AND "
      },
      {
        "lineNumber": 437,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "              b.driver_id \u003d a.driver_id) AS num_bidders,"
      },
      {
        "lineNumber": 438,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       (a.departure_time::timestamp(0) - CURRENT_TIMESTAMP::timestamp(0) - "
      },
      {
        "lineNumber": 439,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "           \u002730 minutes\u0027::interval) AS time_remaining"
      },
      {
        "lineNumber": 440,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "FROM advertisement a "
      },
      {
        "lineNumber": 441,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE a.departure_time \u003e (CURRENT_TIMESTAMP + \u002730 minutes\u0027::interval) AND "
      },
      {
        "lineNumber": 442,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "      ad_status \u003d \u0027Active\u0027 and a.driver_id \u003c\u003e {{ username }} "
      },
      {
        "lineNumber": 443,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 444,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 445,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Suggestion of the best promo code for current payment"
      },
      {
        "lineNumber": 446,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "The best promo code that will be suggested to the user will be based on:"
      },
      {
        "lineNumber": 447,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1. The highest discount w.r.t the current payment price (e.g. if payment price is $40, and the promo code discounts $50, then the discount w.r.t the current price is $40)"
      },
      {
        "lineNumber": 448,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2. The smallest discount price of the promo code"
      },
      {
        "lineNumber": 449,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "3. The most number of quota left for the promo code"
      },
      {
        "lineNumber": 450,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "4. If there is still a tie, the best promo is chosen based on the ascending order of promo_code, alphabetically"
      },
      {
        "lineNumber": 451,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 452,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "There are additional constraints where the quota of the promo code must not be used up and the bidded price must be higher than the minimum price of promo in order to use the promo code."
      },
      {
        "lineNumber": 453,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```sql"
      },
      {
        "lineNumber": 454,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WITH MostDiscountedAndAvailablePromos AS ("
      },
      {
        "lineNumber": 455,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "SELECT p.promo_code, p.discount, "
      },
      {
        "lineNumber": 456,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "       (p.max_quota - (SELECT COUNT(*) FROM Redeems r "
      },
      {
        "lineNumber": 457,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                       WHERE r.promo_code \u003d p.promo_code)) AS amount_left"
      },
      {
        "lineNumber": 458,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "FROM Promo p"
      },
      {
        "lineNumber": 459,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE p.min_price \u003c\u003d {{ bid_price }} AND"
      },
      {
        "lineNumber": 460,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "      p.max_quota \u003e "
      },
      {
        "lineNumber": 461,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "          (SELECT COUNT(*) FROM Redeems r "
      },
      {
        "lineNumber": 462,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "           WHERE r.promo_code \u003d p.promo_code AND "
      },
      {
        "lineNumber": 463,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                ("
      },
      {
        "lineNumber": 464,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                 p.discount \u003d (SELECT MAX(p1.discount) FROM Promo p1) OR "
      },
      {
        "lineNumber": 465,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                    (p.discount \u003e\u003d {{ bid_price }})"
      },
      {
        "lineNumber": 466,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                )"
      },
      {
        "lineNumber": 467,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "           )"
      },
      {
        "lineNumber": 468,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "),"
      },
      {
        "lineNumber": 469,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "PromoStatistics AS ("
      },
      {
        "lineNumber": 470,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "\tSELECT *, CASE "
      },
      {
        "lineNumber": 471,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "\tWHEN (discount \u003d (SELECT MIN(discount) "
      },
      {
        "lineNumber": 472,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                          FROM MostDiscountedAndAvailablePromos)) "
      },
      {
        "lineNumber": 473,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "        THEN 1 ELSE 0 END AS is_least_discount"
      },
      {
        "lineNumber": 474,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "\tFROM MostDiscountedAndAvailablePromos "
      },
      {
        "lineNumber": 475,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ")"
      },
      {
        "lineNumber": 476,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "SELECT PS1.promo_code, PS1.discount FROM PromoStatistics PS1"
      },
      {
        "lineNumber": 477,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "WHERE NOT EXISTS ("
      },
      {
        "lineNumber": 478,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "\tSELECT 1 FROM PromoStatistics PS2"
      },
      {
        "lineNumber": 479,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "  \tWHERE (PS2.is_least_discount \u003e PS1.is_least_discount) OR "
      },
      {
        "lineNumber": 480,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "              (PS2.is_least_discount \u003d PS1.is_least_discount AND "
      },
      {
        "lineNumber": 481,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "                   PS2.amount_left \u003e PS1.amount_left)"
      },
      {
        "lineNumber": 482,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ")"
      },
      {
        "lineNumber": 483,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "ORDER BY PS1.promo_code ASC"
      },
      {
        "lineNumber": 484,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "```"
      },
      {
        "lineNumber": 485,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 486,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "# Web Page Design and Functionality"
      },
      {
        "lineNumber": 487,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 488,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Home Page"
      },
      {
        "lineNumber": 489,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Description:"
      },
      {
        "lineNumber": 490,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "This page is the default page every user will see after a successful login. As show in figure below, it has three main functions:"
      },
      {
        "lineNumber": 491,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1) search bar to filter down advertisements with searched destination."
      },
      {
        "lineNumber": 492,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2) list of currently active advertisements available for bidding."
      },
      {
        "lineNumber": 493,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "3) list of advertisements that user has bidded for, along with the bid status (`failed`, `success`, `ongoing`)."
      },
      {
        "lineNumber": 494,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 495,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "![](https://i.imgur.com/wmWEUgz.jpg)"
      },
      {
        "lineNumber": 496,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 497,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Share A Ride Page"
      },
      {
        "lineNumber": 498,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Description:"
      },
      {
        "lineNumber": 499,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "This page is designed for users (who are drivers) to be able to share their ride advertisements. The page will first check for the two criterias:"
      },
      {
        "lineNumber": 500,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1) User is a driver"
      },
      {
        "lineNumber": 501,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2) Driver has registered a car"
      },
      {
        "lineNumber": 502,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 503,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "If both criterias are met, the user will be able to fill up a form with the relevant basic information (as shown in figure below) required for the advertisement to be listed on the home page. Else, the user will be redirected to the car registration page."
      },
      {
        "lineNumber": 504,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 505,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Upon a successful creation of advertisement, the advertisement will be available on the home page for passengers to bid. Advertisements can be deleted in the following page."
      },
      {
        "lineNumber": 506,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 507,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "![](https://i.imgur.com/rRDniII.jpg)"
      },
      {
        "lineNumber": 508,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 509,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Advertisement Management Page"
      },
      {
        "lineNumber": 510,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Description:"
      },
      {
        "lineNumber": 511,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "This page is designed for users (who are drivers) to be able to view and manage advertisements they posted previously. It is personal and unique to each user unlike the home page which is a general page that is common for all users. As show in figure below, there are two lists on this page:"
      },
      {
        "lineNumber": 512,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1) List of advertisements posted by the driver"
      },
      {
        "lineNumber": 513,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2) List of bids passengers placed for all advertisements"
      },
      {
        "lineNumber": 514,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 515,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "![](https://i.imgur.com/4JokrfU.jpg)"
      },
      {
        "lineNumber": 516,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 517,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "On this page, the driver can choose to delete a previously posted advertisement, or accept a bid of his choice. Upon accepting a bid, the advertisement will be taken down from the driver\u0027s list of advertisements and from the home page. A new ride will then be scheduled and will appear in the following page."
      },
      {
        "lineNumber": 518,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 519,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Additional features:"
      },
      {
        "lineNumber": 520,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "The `System Accept` button is a simulation of an automated system selection for demonstration purposes. It simulates an automatic selection done by the system when the system detects that the time is up (30 mins before scheduled time to leave). "
      },
      {
        "lineNumber": 521,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 522,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "The system will allocate the winning bid based on the following descending order of priority:"
      },
      {
        "lineNumber": 523,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1.  highest bid price"
      },
      {
        "lineNumber": 524,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2.  highest passenger rating"
      },
      {
        "lineNumber": 525,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "3.  highest number of completed rides at the point of query"
      },
      {
        "lineNumber": 526,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "4.  if there is still a tie, the winning bid is chosen based on their ascending order of username, alphabetically"
      },
      {
        "lineNumber": 527,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 528,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 529,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Scheduled Page"
      },
      {
        "lineNumber": 530,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Description:"
      },
      {
        "lineNumber": 531,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "This page shows a list of  upcoming rides scheduled for the user (passenger) upon a successful bid. If the user is a driver, he/ she will be able to see an addition list of upcoming pick-ups."
      },
      {
        "lineNumber": 532,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "Besides the two lists, there are three types of buttons on this page:"
      },
      {
        "lineNumber": 533,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "1) **Review:** for passenger/ driver to rate the other party."
      },
      {
        "lineNumber": 534,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "2) **Pay:** for passenger to pay before, during or after the ride."
      },
      {
        "lineNumber": 535,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "3) **Pick-up/Drop off:** for driver to indicate the start and end of the ride."
      },
      {
        "lineNumber": 536,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 537,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "![](https://i.imgur.com/ancb8Zk.jpg)"
      },
      {
        "lineNumber": 538,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 539,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Payment Page"
      },
      {
        "lineNumber": 540,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Description:"
      },
      {
        "lineNumber": 541,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "The following page shows the payment page where passengers are able to pay for their scheduled rides. There will be a message on suggesting the promo code available with the best rebates for the passenger to apply."
      },
      {
        "lineNumber": 542,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 543,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "![](https://i.imgur.com/5pchNkl.jpg)"
      },
      {
        "lineNumber": 544,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 545,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 546,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "### Additional features:"
      },
      {
        "lineNumber": 547,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "If the ride has ended and the passenger have not paid, all buttons and actions will redirect user to the payment page so that user cannot access any other functionality before he/she pays."
      },
      {
        "lineNumber": 548,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 549,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": ""
      },
      {
        "lineNumber": 550,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "# Summary"
      },
      {
        "lineNumber": 551,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "## Difficulties Faced"
      },
      {
        "lineNumber": 552,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- Finalizing entity/ relationship sets and ER diagram in the initial phase of the project as it took several iterations before we understood the project requirements and came out with a suitable ER diagram"
      },
      {
        "lineNumber": 553,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- Making sure the features of the app are cohesive and match the design requirements"
      },
      {
        "lineNumber": 554,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- As some of us had no experience with front-end development, we took significant time to learn and get started with Python Flask and in particular, how to parse the data between front-end and back-end"
      },
      {
        "lineNumber": 555,
        "author": {
          "gitId": "Shuyuan"
        },
        "content": "- Finding and taking the time to discuss as a team proved to be challenging as everyone had other academic commitments"
      }
    ],
    "authorContributionMap": {
      "Shuyuan": 555
    }
  }
]
